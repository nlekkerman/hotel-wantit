{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container">
  <h2>Reserve Room</h2>
  <div class="row">
    <div class="col-md-6 bg-warning">
      <h4>Room Information</h4>
      <p><strong>Room Number:</strong> {{ room.room_number }}</p>
      <p><strong>Type:</strong> {{ room.room_type }}</p>
      <p><strong>Price:</strong> {{ room.price }}</p>
      <p><strong>Description:</strong> {{ room.description }}</p>
    </div>
    <div class="col-md-6">
      <h4>Reservation Form</h4>
      <form id="reservation-form" method="post" action="{% url 'reserve_room' room.id %}">
        {% csrf_token %}
        <input type="hidden" name="room_id" value="{{ room.id }}">
        <div class="form-group">
          <label for="id_name" class="label-name">Name:</label>
          <input type="text" id="id_name" name="name" class="form-control" placeholder="Enter your name">
        </div>
        <div class="form-group">
          <label for="id_email" class="label-email">Email:</label>
          <input type="email" id="id_email" name="email" class="form-control" placeholder="Enter your email">
        </div>
        <div class="form-group">
          <label for="id_phone" class="label-phone">Phone:</label>
          <input type="tel" id="id_phone" name="phone" class="form-control" placeholder="Enter your phone number">
        </div>
        <div class="form-group">
          <label for="id_checkin_date" class="label-checkin-date">Check-in Date:</label>
          <input type="date" id="id_checkin_date" name="checkin_date" class="form-control">
        </div>
        <div class="form-group">
          <label for="id_checkout_date" class="label-checkout-date">Check-out Date:</label>
          <input type="date" id="id_checkout_date" name="checkout_date" class="form-control">
        </div>
        <button type="submit" class="btn btn-primary">Reserve Room</button>
        <button id="availability-button" type="button" class="btn btn-primary">Check Availability</button>
      </form>
    </div>
  </div>
</div>

<!-- Modal -->
<div class="modal fade" id="reservationModal" tabindex="-1" role="dialog" aria-labelledby="reservationModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="reservationModalLabel">Reservation Information</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body" id="reservationModalBody">
        <!-- Reservation information will be displayed here -->
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" id="reserveButton" style="display: none;">Reserve Room</button>
      </div>
    </div>
  </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$(document).ready(function () {
    $("#availability-button").click(function () {
        var roomId = $("#id_room_id").val();
        var checkinDate = $("#id_checkin_date").val();
        var checkoutDate = $("#id_checkout_date").val();

        // Send AJAX request to Django view
        $.ajax({
            type: "POST",
            url: "{% url 'check_availability' %}",
            data: {
                room_id: roomId,
                checkin_date: checkinDate,
                checkout_date: checkoutDate,
                csrfmiddlewaretoken: $("input[name=csrfmiddlewaretoken]").val()
            },
            dataType: "json",
            success: function (response) {
                if (response.available) {
                    // Room is available, populate modal with reservation information
                    $("#reservationModalBody").html(response.reservation_info);
                    $("#reserveButton").show();
                } else {
                    // Room is not available
                    $("#reservationModalBody").text("This room is not available for the specified period.");
                    $("#reserveButton").hide();
                }
                // Open the modal
                $("#reservationModal").modal("show");
            },
            error: function (xhr, status, error) {
                console.error("Error:", xhr.status);
            }
        });
    });

    $("#reserveButton").click(function () {
        // Submit the reservation form
        $("#reservation-form").submit();
    });
});

</script>
{% endblock %}
