{% extends 'base.html' %}
{% load static %}

{% block content %}
    
    <div class="resevation-details-container">
    <div class="reservation-details">
        <button class="close-button" id="close_button">
            <i class="fa fa-times"></i>
        </button>
        <h2 class="cancel-reservation-title">Reservation Number:<strong>{{ reservation.id }} </strong></h2>
         
        <div class="reservations-details-content">
        <p><strong>Name:</strong> {{ reservation.name }}</p>
        <p><strong>Check-in Date:</strong> {{ reservation.checkin_date }}</p>
        <p><strong>Check-out Date:</strong> {{ reservation.checkout_date }}</p>
        <p><strong>Price:</strong> {{ reservation.price }}</p>

    </div>
        <!-- Add more details as needed -->

        <!-- Button to trigger cancellation modal -->
        <button id="openCancelModal" class="btn custom-buttons cancellation_buton_style">Cancel Reservation</button>
    </div>

    <!-- Modal for cancellation confirmation -->
    <div id="cancelReservationModal" class="modal">


        <div class="modal-content ">
            <span class="close" onclick="closeModal('cancelReservationModal')">&times;</span>
            <h2 class="cancel-reservation-title">Reservation Number:<strong>{{ reservation.id }} </strong></h2>
            <p class="reservations-details-content">Are you sure you want to cancel this reservation?</p>
            <form id="cancelReservationForm" data-reservation-id="{{ reservation.id }}">
                {% csrf_token %}
                
            </form>
            <button type="submit" class="btn custom-buttons">Confirm Cancellation</button>
        </div>
    </div>
</div>
    <script>


        // Handle close button click to navigate to user notifications
        document.getElementById('close_button').addEventListener('click', function() {
            window.location.href = '{% url "user-notifications" %}';
        });
        // Function to open modal
        function openModal(modalId) {
            var modal = document.getElementById(modalId);
            modal.style.display = "block";
        }

        // Function to close modal
        function closeModal(modalId) {
            var modal = document.getElementById(modalId);
            modal.style.display = "none";
            window.location.href = '{% url "home" %}';
        }

        // Open cancellation modal when button is clicked
        document.getElementById('openCancelModal').addEventListener('click', function(event) {
            event.preventDefault();
            openModal('cancelReservationModal');
        });

        document.getElementById('cancelReservationForm').addEventListener('submit', function(event) {
    event.preventDefault();
    var form = this;
    var reservationId = form.getAttribute('data-reservation-id');
    
    fetch('/bookings/reservation/' + reservationId + '/cancel/', {
        method: 'POST',
        headers: {
            'X-CSRFToken': '{{ csrf_token }}',
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({})
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // Optionally, show success message or update UI
            alert('Reservation successfully cancelled.');
            closeModal('cancelReservationModal');
            // Redirect to home page after cancellation
            window.location.href = '{% url "home" %}';
        } else {
            // Handle error scenario if needed
            alert('Failed to cancel reservation. Please try again.');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('An unexpected error occurred. Please try again.');
    });
});</script>
{% endblock %}
